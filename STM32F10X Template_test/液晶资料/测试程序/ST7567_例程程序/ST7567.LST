C51 COMPILER V9.01   ST7567                                                                10/01/2014 15:49:22 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE ST7567
OBJECT MODULE PLACED IN ST7567.OBJ
COMPILER INVOKED BY: D:\keil4\C51\BIN\C51.EXE ST7567.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1             
   2          
   3          #include "reg51.h"
   4          #include "absacc.h"
   5          #define unchar  unsigned char
   6          #define unint   unsigned int 
   7          //--------------------------------------------------------- 4线SPI接口 驱动
   8                                                                                                                                                            
   9          sbit    RSTB    =P1^3;
  10          
  11          sbit    SDI     =P1^0;
  12          sbit    SCL             =P1^1;
  13          sbit    CS0     =P1^4;
  14          sbit    RS      =P1^2;
  15          
  16          sbit    KEY         =P3^2;
  17          
  18          unchar code graphic1[]=
  19          {
  20          
  21          /*--  宽度x高度=128x64  --*/
  22          0xFF,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
  23          0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
  24          0x01,0x01,0x01,0x01,0x01,0x81,0xC1,0x41,0x41,0x41,0x01,0x01,0x01,0x01,0x01,0x01,
  25          0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
  26          0x01,0x01,0x81,0x01,0x01,0x81,0x81,0xC1,0x01,0x81,0xC1,0x81,0x81,0xC1,0xC1,0x01,
  27          0x81,0x81,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
  28          0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
  29          0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0xFF,
  30          0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  31          0x00,0x00,0x00,0xE0,0xBC,0x84,0xC4,0x74,0x10,0x18,0x08,0x08,0x08,0x60,0xF0,0xB0,
  32          0xD0,0xF0,0xF8,0xFC,0xFE,0xFF,0xE7,0xF3,0xFD,0xF8,0xFC,0xFE,0xFE,0xFF,0xFD,0xFC,
  33          0xFC,0xFE,0xF6,0xF2,0xD0,0x80,0x00,0x00,0x80,0x00,0xE0,0xC0,0xF0,0xF8,0xFE,0xFC,
  34          0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,0x7F,0x7F,0x7F,0x7F,0xFF,0xFF,
  35          0xFF,0xFE,0xFE,0xFF,0xF9,0xFC,0xF4,0x60,0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  36          0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0xF0,0xF8,0xF8,0xFC,0xF8,0xFC,0xFC,0xFE,0xFE,
  37          0xFA,0xFA,0x68,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
  38          0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  39          0x00,0x00,0x00,0x02,0x47,0xC7,0xCF,0xDF,0xEF,0xEE,0xEE,0xEF,0xF7,0x77,0x7F,0x7F,
  40          0x3F,0x1F,0x1F,0x3F,0x3F,0x3F,0xFF,0xDF,0xD7,0xD7,0xD5,0xC5,0xE5,0xF1,0xFF,0xFF,
  41          0xFF,0xFF,0xFF,0x7F,0xFF,0xD9,0xFD,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x7F,
  42          0xBF,0xDF,0x4F,0x77,0x83,0x03,0x01,0x00,0x00,0xC0,0xC0,0xF0,0xF8,0xFC,0xFE,0xFF,
  43          0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x3F,0x3F,0x72,0x00,0x00,0x00,0x00,0x00,0x00,0xC0,
  44          0xF0,0xFC,0xFF,0xFF,0xFF,0xFF,0xFF,0x03,0x01,0x00,0x01,0x01,0x03,0x03,0x07,0x07,
  45          0x05,0x05,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
  46          0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  47          0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x81,0xC1,0x43,0xC7,0xC3,0x07,0x03,0x02,0x00,
  48          0x00,0xFC,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xEF,0xE7,0xF7,0xFF,0xFF,0xF7,
  49          0xFB,0xFF,0xFE,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xDF,0xCF,0xC7,0x85,0x86,0x87,
  50          0x8F,0x8F,0x1D,0x19,0x3D,0x3C,0x3C,0x7C,0x7D,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,
  51          0xFF,0xFE,0xF7,0xFB,0xF8,0xFC,0xF8,0xF8,0xFC,0xFE,0xF8,0xFC,0xFE,0xFC,0xFF,0xFF,
  52          0xFF,0xFF,0x7F,0x7F,0x3F,0x0F,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  53          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
  54          0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  55          0x00,0x00,0x00,0x00,0x00,0xE0,0xC0,0x67,0x7C,0x3F,0x3B,0x39,0x1C,0x1C,0x0E,0x0F,
C51 COMPILER V9.01   ST7567                                                                10/01/2014 15:49:22 PAGE 2   

  56          0x0F,0x0F,0x07,0x07,0x07,0x0F,0x0F,0x0F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,0x1F,
  57          0x1F,0x0F,0x0F,0x0F,0x07,0x07,0x03,0x03,0x03,0x03,0x03,0x01,0x21,0x71,0x59,0x9B,
  58          0xEF,0x7F,0x3F,0x03,0x03,0x01,0x01,0x03,0x00,0x00,0x03,0x07,0x07,0x03,0x07,0x07,
  59          0x0F,0x07,0x07,0x0F,0x07,0x0F,0x0F,0x0F,0x1F,0x9F,0x9F,0xDF,0xFB,0xFB,0x79,0x39,
  60          0x19,0x18,0x08,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  61          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
  62          0xFF,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x80,0x80,0x00,0x00,0x80,0x00,0x00,
  63          0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  64          0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  65          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,
  66          0x00,0x01,0x01,0x00,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  67          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x80,0x01,0x01,0x00,
  68          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  69          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,
  70          0xFF,0x00,0x00,0x00,0x00,0x7F,0x7F,0x04,0x04,0x7F,0x7F,0x02,0x3F,0x7F,0x42,0x02,
  71          0x3F,0x7F,0x42,0x00,0xFE,0xFE,0x42,0x42,0x7E,0x3C,0x00,0x66,0x66,0x00,0x60,0x1E,
  72          0x01,0x60,0x1E,0x01,0x7E,0x7E,0x00,0x7F,0x7F,0x00,0x3C,0x7E,0x42,0x42,0x7E,0x3C,
  73          0x00,0x1E,0x7E,0x60,0x7E,0x1E,0x00,0x3C,0x7E,0x4A,0x4A,0x6E,0x2C,0x00,0x7F,0x7F,
  74          0x00,0x66,0x7E,0x18,0x7E,0x66,0x00,0x7F,0x7F,0x00,0x60,0x60,0x00,0x3C,0x7E,0x4A,
  75          0x4A,0x6E,0x2C,0x00,0x3C,0x7E,0x4A,0x4A,0x6E,0x2C,0x02,0x3F,0x7F,0x42,0x00,0x3C,
  76          0x7E,0x42,0x42,0x7E,0x3C,0x00,0xFE,0xFE,0x42,0x42,0x7E,0x3C,0x00,0x60,0x60,0x00,
  77          0x3C,0x7E,0x42,0x66,0x24,0x00,0x7E,0x7E,0x02,0x02,0x7E,0x7C,0x00,0x00,0x00,0xFF,
  78          0xFF,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  79          0x80,0x80,0x80,0x80,0x81,0x81,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  80          0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  81          0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  82          0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  83          0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  84          0x80,0x80,0x80,0x80,0x80,0x80,0x81,0x81,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
  85          0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0xFF,
  86          };
  87          void Init_ST7567();
  88          void Write_ST7567_COM(unchar COMDADA_4SPI);
  89          void Write_ST7567_DISPLAY_DATA_serial_4SPI(unchar DADA_4SPI);
  90          void Delay_ms(unsigned long value);
  91          void HDReset();
  92          void Keypress(void);
  93          void clear_screen(unchar xx);
  94          void Display_pic1();
  95          
  96          
  97          void main()
  98          {       
  99   1              Init_ST7567();
 100   1              while(1)
 101   1              {
 102   2               clear_screen(0x00);
 103   2              Delay_ms(1000);
 104   2               clear_screen(0xff);
 105   2              Delay_ms(1000);
 106   2               clear_screen(0x55);
 107   2              Delay_ms(1000);
 108   2               clear_screen(0xaa);
 109   2              Delay_ms(1000);
 110   2               clear_screen(0x33);
 111   2               Display_pic1();
 112   2               Keypress();
 113   2               }
 114   1      
 115   1      }
 116          
 117          //--------------------------------------------------------------------------
C51 COMPILER V9.01   ST7567                                                                10/01/2014 15:49:22 PAGE 3   

 118          
 119          void Init_ST7567()
 120          {
 121   1              HDReset();
 122   1              Delay_ms(100);
 123   1      
 124   1             Write_ST7567_COM(0xe2);   //Soft rest
 125   1      
 126   1             Write_ST7567_COM(0xa2);   //SET LCD bias(A2-1/9bias; A3-1/7bias)
 127   1             Write_ST7567_COM(0xa0);   //SET ADC NORMAL(OB-POR seg0-00h) A0: NORMAL  A1: REVERSE
 128   1             Write_ST7567_COM(0xc8);     //SET COM OUTPUT SCAN DIRECTION(0XXXB-NORMAL)-POR  COM63-->COM0
 129   1                         
 130   1             Write_ST7567_COM(0xa4);     // SET DISPLAY NORMAL (0B-NORMAL)-POR  A4:NORMAL A5:ENTIRE DISPLAY ON
 131   1             Write_ST7567_COM(0xa6);     //SET NORMAL DISPLAY MODE(0B-NORMAL)  A6:NORMAL  A7:REVERSE
 132   1             Write_ST7567_COM(0x25);     //SET INTERNAL REGULATOR RESDASTOR RATIO(100B)-POR
 133   1      
 134   1             Write_ST7567_COM(0x81);
 135   1                         
 136   1             Write_ST7567_COM(0x1a);     // SET CONTRAST CONTROL REGISTER(00,0000H-11,1111H) 30  对比度请修改此值
             -，调浓增大此值，反之调淡。
 137   1             Write_ST7567_COM(0x2f);     //SET POWER CONTROL REGISTER (ALL INTERNAL)
 138   1      
 139   1             Write_ST7567_COM(0x40);     //end of initialzation
 140   1             Write_ST7567_COM(0xaf);     //DisPlay On
 141   1      
 142   1      }
 143          
 144          
 145          void clear_screen(unchar xx)
 146          {
 147   1      unchar i,j;
 148   1      for(i=0;i<9;i++)
 149   1              {
 150   2                      CS0=0;
 151   2                      Write_ST7567_COM(0xb0+i);
 152   2                  Write_ST7567_COM(0x10);
 153   2                      Write_ST7567_COM(0x00);
 154   2                      for(j=0;j<132;j++)
 155   2                      {
 156   3                              Write_ST7567_DISPLAY_DATA_serial_4SPI(xx);
 157   3                      }
 158   2               }
 159   1      }
 160          
 161          void Display_pic1()
 162          {
 163   1              unint i,j,adressd=0;
 164   1      
 165   1              for(i=0;i<8;i++)
 166   1              {
 167   2                      CS0=0;
 168   2                      Write_ST7567_COM(0xb0+i);
 169   2                  Write_ST7567_COM(0x10);
 170   2                      Write_ST7567_COM(0x00);
 171   2                      for(j=0;j<128;j++)
 172   2                      {
 173   3                              Write_ST7567_DISPLAY_DATA_serial_4SPI(graphic1[adressd]);
 174   3                              adressd++;
 175   3                      }
 176   2              }
 177   1      } 
 178          //***************************************************************************SPI4
C51 COMPILER V9.01   ST7567                                                                10/01/2014 15:49:22 PAGE 4   

 179          void Write_ST7567_COM(unchar COMDADA_4SPI)
 180          {
 181   1              unchar bit8;
 182   1              RS=0;
 183   1              CS0=0;
 184   1              for(bit8=0;bit8<8;bit8++)
 185   1              {
 186   2                      SCL=0;
 187   2                      if((COMDADA_4SPI&0x80)==0x80)
 188   2                      SDI=1;
 189   2                      else            
 190   2                      SDI=0;
 191   2      //              SCL=0;
 192   2                      SCL=1;
 193   2                      COMDADA_4SPI=(COMDADA_4SPI<<1);
 194   2      
 195   2              }
 196   1        //  CS1=1;
 197   1                              
 198   1      }
 199          
 200          void Write_ST7567_DISPLAY_DATA_serial_4SPI(unchar DADA_4SPI)
 201          {   
 202   1              unchar bit8;
 203   1              RS=1;
 204   1              CS0=0;                          
 205   1      
 206   1              for(bit8=0;bit8<8;bit8++)
 207   1              {
 208   2                      SCL=0;
 209   2                      if((DADA_4SPI&0x80)==0x80)
 210   2                      SDI=1;
 211   2                      else
 212   2                      SDI=0;
 213   2                      SCL=1;
 214   2                      DADA_4SPI=(DADA_4SPI<<1);
 215   2      
 216   2              }
 217   1      //      CS1=1;
 218   1      }
 219          
 220                          
 221          void Delay_ms(unsigned long value)
 222          {
 223   1              unint i,j;
 224   1          for (i=0;i<value;i++)
 225   1                      for (j=0;j<500;j++);
 226   1      }
 227          
 228          void HDReset()
 229          {
 230   1              RSTB=0;
 231   1              Delay_ms(2);
 232   1              RSTB=1;
 233   1              Delay_ms(4);
 234   1      }
 235          
 236          void Keypress()
 237                  {
 238   1              while(KEY)
 239   1              Delay_ms(10);
 240   1              }               
C51 COMPILER V9.01   ST7567                                                                10/01/2014 15:49:22 PAGE 5   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    416    ----
   CONSTANT SIZE    =   1024    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      13
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
